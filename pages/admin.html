<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<link rel="icon" type="image/x-icon" href="../assets/assetsss/favicon.ico" />
<title>Admin Page</title>
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Bootstrap CRUD Data Table for Database with Modal Form</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto|Varela+Round">
<link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="stylesheet" href="https://cdn.datatables.net/2.0.5/css/dataTables.dataTables.css" />
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>

</head>
  <body>
	<div class="container">
	
	  
	  <!-- Modal -->
	  <div class="modal fade" id="exampleModal">
		<div class="modal-dialog">
		  <div class="modal-content">
			<div class="modal-header">
			  <h5 class="modal-title" id="exampleModalLabel">Modal title</h5>
			  <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
			</div>
			<div class="modal-body">
			  ...
			</div>
			<div class="modal-footer">
			  <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
			  <button type="button" class="btn btn-primary">Save changes</button>
			</div>
		  </div>
		</div>
	  </div>
	
    <div class="container" style="margin-top: 60px;">
        <div class="table-wrapper">
            <div class="table-title">
                <div class="row">
                    <div class="col-sm-6">
						<h2 style="margin-left: 80px;">Products Management</h2> <br><br>
					</div>
					<div class="col-sm-6">
						<!-- <a href="#" id="addNewProductBtn" class="btn btn-success" data-toggle="modal" data-bs-target="#addNewProductModal"><i class="material-icons">&#xE147;</i> <span>Add New Product</span></a> -->
						<button type="button" class="btn btn-success" data-bs-toggle="modal" data-bs-target="#addNewProductModal">
							Add New Product
						  </button>
					</div>
                </div>
            </div>
        </div>
    </div>
	<!-- Edit Modal HTML -->
	<div id="addEmployeeModal" class="modal fade">
		<div class="modal-dialog">
			<div class="modal-content">
				<form>
					<div class="modal-header">						
						<h4 class="modal-title">Edit Product</h4>
						<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
					</div>
					<div class="modal-body">					
						<div class="form-group">
							<label>Name</label>
							<input type="text" class="form-control" required>
						</div>
						<div class="form-group">
							<label>Email</label>
							<input type="email" class="form-control" required>
						</div>
						<div class="form-group">
							<label>Address</label>
							<textarea class="form-control" required></textarea>
						</div>
						<div class="form-group">
							<label>Phone</label>
							<input type="text" class="form-control" required>
						</div>					
					</div>
					<div class="modal-footer">
						<input type="button" class="btn btn-default" data-dismiss="modal" value="Cancel">
						<input type="submit" class="btn btn-success" value="Add">
					</div>
				</form>
			</div>
		</div>
	</div>

	<!-- Modal -->
<div class="modal fade" id="becirovModal" tabindex="-1" aria-labelledby="becirovModalLabel" aria-hidden="true">
	<div class="modal-dialog">
	  <div class="modal-content">
		<div class="modal-header">
		  <h5 class="modal-title" id="becirovModalLabel">Modal title</h5>
		  <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
		</div>
		<div class="modal-body">
		  <form>
			<div class="mb-3">
			  <label for="productName" class="col-form-label">Product Name:</label>
			  <input type="text" name="productName" class="form-control" id="productName">
			</div>
			<div class="mb-3">
			  <label for="productPrice" class="col-form-label">Product Price:</label>
			  <input type="number" name="productPrice" class="form-control" id="productPrice">
			</div>
			<div class="mb-3">
			  <label for="countryOfOrigin" class="col-form-label">Country Of Origin:</label>
			  <input type="text" name="countryOfOrigin" class="form-control" id="countryOfOrigin">
			</div>
		  </form>
		</div>
		<div class="modal-footer">
		  <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
		  <button id="submitBtn" type="submit" class="btn btn-primary">Save changes</button>
		</div>
	  </div>
	</div>
  </div>
  <!-- Modal -->
<div class="modal fade" id="adminModal" tabindex="-1" aria-labelledby="adminModalLabel" aria-hidden="true">
	<div class="modal-dialog">
	  <div class="modal-content">
		<div class="modal-header">
		  <h5 class="modal-title" id="adminModalLabel">Modal title</h5>
		  <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
		</div>
		<div class="modal-body">
		  <form>
			<div class="mb-3">
			  <label for="name" class="col-form-label">Admin Name:</label>
			  <input type="text" name="name" class="form-control" id="name">
			</div>
			<div class="mb-3">
			  <label for="surname" class="col-form-label">Admin Surname:</label>
			  <input type="text" name="surname" class="form-control" id="surname">
			</div>
			<div class="mb-3">
			  <label for="email" class="col-form-label">Email:</label>
			  <input type="text" name="email" class="form-control" id="email">
			</div>
		  </form>
		</div>
		<div class="modal-footer">
		  <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
		  <button id="submitBtnAdmin" type="submit" class="btn btn-primary">Save changes</button>
		</div>
	  </div>
	</div>
  </div>
  <!-- Add New Product Modal -->
  <div class="modal fade" id="addNewProductModal" tabindex="-1" aria-labelledby="addProductModalLabel" aria-hidden="true">
	<div class="modal-dialog">
	  <div class="modal-content">
		<div class="modal-header">
		  <h5 class="modal-title" id="addProductModalLabel">Add Product</h5>
		  <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
		</div>
		<div class="modal-body">
		  <form id="productForm">
			<div class="mb-3">
			  <label for="productName" class="col-form-label">Product Name:</label>
			  <input type="text" name="productName" class="form-control" id="productName">
			</div>
			<div class="mb-3">
			  <label for="productPrice" class="col-form-label">Product Price:</label>
			  <input type="number" name="productPrice" class="form-control" id="productPrice">
			</div>
			<div class="mb-3">
			  <label for="countryOfOrigin" class="col-form-label">Country Of Origin:</label>
			  <input type="text" name="countryOfOrigin" class="form-control" id="countryOfOrigin">
			</div>
		  </form>
		</div>
		<div class="modal-footer">
		  <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
		  <button id="submitBtnnn" type="submit" class="btn btn-primary">Save changes</button>
		</div>
	  </div>
	</div>
  </div>
  <!-- Add New Admin Modal -->
  <div class="modal fade" id="addNewAdminModal" tabindex="-1" aria-labelledby="addAdminModalLabel" aria-hidden="true">
	<div class="modal-dialog">
	  <div class="modal-content">
		<div class="modal-header">
		  <h5 class="modal-title" id="addAdminModalLabel">Add Admin</h5>
		  <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
		</div>
		<div class="modal-body">
		  <form id="adminForm">
			<div class="mb-3">
			  <label for="name" class="col-form-label">Admin Name:</label>
			  <input type="text" name="name" class="form-control" id="name">
			</div>
			<div class="mb-3">
			  <label for="surname" class="col-form-label">Admin Surname:</label>
			  <input type="text" name="surname" class="form-control" id="surname">
			</div>
			<div class="mb-3">
			  <label for="email" class="col-form-label">Admin Email:</label>
			  <input type="text" name="email" class="form-control" id="email">
			</div>
		  </form>
		</div>
		<div class="modal-footer">
		  <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
		  <button id="submitAdmin" type="submit" class="btn btn-primary">Save changes</button>
		</div>
	  </div>
	</div>
  </div>
	<!-- Edit Modal HTML -->
	<div id="editEmployeeModal" class="modal fade">
		<div class="modal-dialog">
			<div class="modal-content">
				<form>
					<div class="modal-header">						
						<h4 class="modal-title">Edit Product</h4>
						<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
					</div>
					<div class="modal-body">					
						<div class="form-group">
							<label>Product</label>
							<input type="text" class="form-control" required>
						</div>
						<div class="form-group">
							<label>Category</label>
							<input type="email" class="form-control" required>
						</div>
						<div class="form-group">
							<label>Release date</label>
							<textarea class="form-control" required></textarea>
						</div>
						<div class="form-group">
							<label>Rating</label>
							<input type="text" class="form-control" required>
						</div>	
						<div class="form-group">
							<label>Description</label>
							<input type="text" class="form-control" required>
						</div>		
						<div class="form-group">
							<label>Company Name</label>
							<input type="text" class="form-control" required>
						</div>	
						
						<div class="form-group">
							<label for="picture">Picture</label>
							<input type="file" id="picture" name="picture" accept="image/*" required>
						</div>	
										
					</div>
					<div class="modal-footer">
						<input type="button" class="btn btn-default" data-dismiss="modal" value="Cancel">
						<input type="submit" class="btn btn-info" value="Save">
					</div>
				</form>
			</div>
		</div>
	</div>
	<!-- Delete Modal HTML -->
	<div id="deleteEmployeeModal" class="modal fade">
		<div class="modal-dialog">
			<div class="modal-content">
				<form>
					<div class="modal-header">						
						<h4 class="modal-title">Delete Product</h4>
						<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
					</div>
					<div class="modal-body">					
						<p>Are you sure you want to delete these Records?</p>
						<p class="text-warning"><small>This action cannot be undone.</small></p>
					</div>
					<div class="modal-footer">
						<input type="button" class="btn btn-default" data-dismiss="modal" value="Cancel">
						<input type="submit" class="btn btn-danger" value="Delete">
					</div>
				</form>
			</div>
		</div>
	</div>
	<div class="mt-5">
        <table id="products-table" class="table table-stripped"></table>
      </div>
	
	</div>
	<div class="container" style="margin-top: 60px;">
        <div class="table-wrapper">
            <div class="table-title">
                <div class="row">
                    <div class="col-sm-6">
						<h2 style="margin-left: 80px;">Admins Management</h2> <br><br>
					</div>
					<div class="col-sm-6">
						<!-- <a href="#" id="addNewProductBtn" class="btn btn-success" data-toggle="modal" data-bs-target="#addNewProductModal"><i class="material-icons">&#xE147;</i> <span>Add New Product</span></a> -->
						<button type="button" class="btn btn-success" data-bs-toggle="modal" data-bs-target="#addNewAdminModal">
							Add New Admin
						  </button>
					</div>
                </div>
            </div>
        </div>
		<div class="mt-5">
			<table id="admins-table" class="table table-stripped"></table>
		  </div>
    </div>
</div>

	<!-- Button trigger modal -->
</body>
    

    <!-- Added JS and jquery-->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script> 
    <!-- <script src="spapp/js/jquery.3.7.1.js"></script> -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.20.0/jquery.validate.min.js"></script> 
    <!--<script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>-->
    <script src="https://cdn.datatables.net/2.0.5/js/dataTables.js"></script>


    <script src="../assets/js/scripts.js"></script>
    <script src="../services//ajax.js"></script>
	<script src="../utils/utils.js"></script>

	<script>
		// let table = new DataTable('#example');
// 		$(document).ready( function () {
//     $('#products-table').DataTable();
// } );

	</script>
	<!-- Bootstrap core JS-->
	<script src="https://cdn.datatables.net/2.0.5/js/dataTables.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
	<!-- Core theme JS-->
	<script src="../assets/js/scripts.js"></script>

	<script>
		$(document).ready(function () {

			const form = $('#productForm');
		  const submitButton = $('#submitBtnnn');
		
		  // Add an event listener to the submit button
		  submitButton.on('click', function (event) {
			event.preventDefault(); // Prevent the default form submission behavior
		
			var newFormData = $('#productForm').serializeArray();
                
                // Convert the serialized array to an object
                var formDataObject = {};
                $.each(newFormData, function(index, field) {
                    formDataObject[field.name] = field.value;
                });
				console.log(formDataObject);
		// 	const formData = {
		// 	  productName: $('#productName').val(),
		// 	  productPrice: $('#productPrice').val(),
		// 	  countryOfOrigin: $('#countryOfOrigin').val()
		// 	};
		// console.log("tHE form data is: "+JSON.stringify(formData));
			$.ajax({
			  url: 'http://localhost/Web-Project/backend/products/add',
			  type: 'POST',
			  contentType: 'application/json',
			  data: JSON.stringify(formDataObject),
			  headers: {
			  "Authentication": Utils.get_from_localstorage("user").token
			   },
			  success: function (response) {
				console.log('Success:', response);
			  },
			  error: function (xhr, status, error) {
				console.error('Error:', error);
			  }
			});
		  });
		});
		</script>

		<script>
			$(document).ready(function () {
			  const form = $('#adminForm');
			  const submitAdmin = $('#submitAdmin');
			
			  // Add an event listener to the submit button
			  submitAdmin.on('click', function (event) {
				event.preventDefault(); // Prevent the default form submission behavior
			
				// const formData = {
				//   name: $('#name').val(),
				//   surname: $('#surname').val(),
				//   email: $('#email').val()
				// };
				// console.log("The Form Data in Admin is: " + JSON.stringify(formData))
				var newData = $('#adminForm').serializeArray();
                
                // Convert the serialized array to an object
                var formDataObject = {};
                $.each(newData, function(index, field) {
                    formDataObject[field.name] = field.value;
                });
			
				$.ajax({
				  url: 'http://localhost/Web-Project/backend/admins/add',
				  type: 'POST',
				  contentType: 'application/json',
				  data: JSON.stringify(formDataObject),
				  headers: {
			      "Authentication": Utils.get_from_localstorage("user").token
			      },
				  success: function (response) {
					console.log('Success:', response);
				  },
				  error: function (xhr, status, error) {
					console.error('Error:', error);
					console.error('Response:', xhr.responseText); 
				  }
				});
			  });
			});
			</script>

	<script>
		
// $(document).ready(function(){
// 	$("#productForm").validate({

// submitHandler: function(form) {
//           // If the form is valid, serialize form data and send POST request
//           let formData = $(form).serialize();
//           console.log("THE FORM DATA IS: " + formData);
//           $.post("http://localhost/Web-Project/backend/products/add", formData) //add_user.php
//               .done(function(data){
//                   // Callback function to handle successful response
//                   console.log("Response:", data);
//                   var productData = JSON.parse(data);
//                   console.log("Parsed Product Data:", productData);
            
                  
                 
                  
//               })
//               .fail(function(xhr, error) {
//                   // Callback function to handle failed response
//                   console.error("Failed to send POST request.", error);
//               });
//       }
// 	})
// });

// $('#submitBtnnn').click(function() {
//             $("#productForm").submit(); // Trigger the submit event to invoke validation and submission
//         });

function deleteProduct(product_id) {
    // Populate the modal with user data
    // For now, let's just show the modal
   // $('#editUserModal').modal('show');
    if(confirm("Do you really want to delete this product?")) {
        RestClient.delete(
          "/products/delete/" + product_id,
          {},
          function(data) {
            console.log("Product with id ",product_id," is deleted successfully");
            // var updatedUsers = users.filter(function(user) {
            //         return user.id !== userId;
            //     });
                // Update local storage with the updated user data
                // var index = users.findIndex(function(user) {
                //     return user.id === userId;
                // });
                // // Remove the user from the array
                // if (index !== -1) {
                //     users.splice(index, 1);
                // }
                // localStorage.setItem('userData', JSON.stringify(updatedUsers));
                // // Reload DataTable with the updated user data
                // initializeDatatable("#tutorials-table", users);
          },
        function(error) {
            // Handle error response
            console.error("Error deleting product:", error);
            // Optionally, display the error message to the user
            alert("An error occurred while deleting the product. Please try again later.");
        }
      );
  }
}

function openEditNewModal(product_id) {
        // Populate the modal with user data
        // For now, let's just show the modal
        RestClient.get("/products/" + product_id, function (data) { // previous: RestClient.get("/get_user.php?id=" + user_id, function (data) { 
          console.log("The data inside modal came and it is: ", data);
        $('#becirovModal').modal('show');
        $("#becirovModal input[name='id']").val(data.id);
        $("#becirovModal input[name='productName']").val(data.productName);
        $("#becirovModal input[name='productPrice']").val(data.productPrice);
        $("#becirovModal input[name='countryOfOrigin']").val(data.countryOfOrigin);// #project-form

        $('#submitBtn').off('click').on('click', function() {
			console.log("funkoicja");
            // Update user data
            var updatedData = {
                id: $("#becirovModal input[name='id']").val(),
                productName: $("#becirovModal input[name='productName']").val(),
                productPrice: $("#becirovModal input[name='productPrice']").val(),
                countryOfOrigin: $("#becirovModal input[name='countryOfOrigin']").val()
            };

            // Make AJAX request to update user data
            RestClient.post("/products/edit/"+product_id+"?_method=PUT", updatedData, function(response) {
                console.log(response);
                // Optionally, you can reload the DataTable or perform any other actions here
            }, function(error) {
                console.error("Error updating user data:", error);
                alert("An error occurred while updating user data. Please try again later.");
            });

            // Hide the modal after saving changes
            $('#becirovModal').modal('hide');
        });

      });
      }


		function initializeDatatable(tableId, data) {
    console.log("Initializing DataTable with Data:", data);
    // Destroy the existing DataTable instance
    if ($.fn.DataTable.isDataTable(tableId)) {
      $(tableId).DataTable().destroy();
    }
    // Initialize new DataTable with data
    $(tableId).DataTable({
      columns: [
        { title: "ID", data: "id" },
        { title: "productName", data: "productName" },
        { title: "productPrice", data: "productPrice" },
        { title: "countryOfOrigin", data: "countryOfOrigin" },
        { 
                title: "Action", 
                data: null,
                render: function(data, type, row) {
                    return '<div class="btn-group" role="group" aria-label="Actions">' +
                        '<button type="button" id="editBtn" class="btn btn-warning" onclick="openEditNewModal(' + row.id + ')">Edit</button>' +
                        '<button type="button" class="btn btn-danger" onclick="deleteProduct(' + row.id + ')">Delete</button>' +
                        '</div>';
                }
            }
        // { 
        //   title: "Action", 
        //   data: null,
        //   render: function(data, type, row) {
        //     console.log("The data in render is: " + data); // Log the data object to inspect its properties
        //     console.log("Action property:", data.action); // Log the action property
        //     return data.action; // Render the action column as provided in the data
        //   }
        // }
      ],
      data: data
    });
  };

  function initializeDatatableAdmin(tableId, data) {
    console.log("Initializing DataTable with Data:", data);
    // Destroy the existing DataTable instance
    if ($.fn.DataTable.isDataTable(tableId)) {
      $(tableId).DataTable().destroy();
    }
    // Initialize new DataTable with data
    $(tableId).DataTable({
      columns: [
        { title: "ID", data: "id" },
        { title: "name", data: "name" },
        { title: "surname", data: "surname" },
        { title: "email", data: "email" },
        { 
                title: "Action", 
                data: null,
                render: function(data, type, row) {
                    return '<div class="btn-group" role="group" aria-label="Actions">' +
                        '<button type="button" id="editBtn" class="btn btn-warning" onclick="openEditAdminModal(' + row.id + ')">Edit</button>' +
                        '<button type="button" class="btn btn-danger" onclick="deleteAdmin(' + row.id + ')">Delete</button>' +
                        '</div>';
                }
            }
        // { 
        //   title: "Action", 
        //   data: null,
        //   render: function(data, type, row) {
        //     console.log("The data in render is: " + data); // Log the data object to inspect its properties
        //     console.log("Action property:", data.action); // Log the action property
        //     return data.action; // Render the action column as provided in the data
        //   }
        // }
      ],
      data: data
    });
  };

  function openEditAdminModal(admin_id) {
        // Populate the modal with user data
        // For now, let's just show the modal
        RestClient.get("/admins/" + admin_id, function (data) { // previous: RestClient.get("/get_user.php?id=" + user_id, function (data) { 
          console.log("The data inside modal came and it is: ", data);
        $('#adminModal').modal('show');
        $("#adminModal input[name='id']").val(data.id);
        $("#adminModal input[name='name']").val(data.name);
        $("#adminModal input[name='surname']").val(data.surname);
        $("#adminModal input[name='email']").val(data.email);// #project-form

        $('#submitBtnAdmin').off('click').on('click', function() {
            // Update user data
            var updatedData = {
                id: $("#adminModal input[name='id']").val(),
                name: $("#adminModal input[name='name']").val(),
                surname: $("#adminModal input[name='surname']").val(),
                email: $("#adminModal input[name='email']").val()
            };

            // Make AJAX request to update user data
            RestClient.post("/admins/edit/"+admin_id+"?_method=PUT", updatedData, function(response) {
                console.log(response);
                // Optionally, you can reload the DataTable or perform any other actions here
            }, function(error) {
                console.error("Error updating admin data:", error);
                alert("An error occurred while updating admin data. Please try again later.");
            });

            // Hide the modal after saving changes
            $('#adminModal').modal('hide');
        });

      });
      };

	  function deleteAdmin(admin_id) {
    // Populate the modal with user data
    // For now, let's just show the modal
   // $('#editUserModal').modal('show');
    if(confirm("Do you really want to delete this admin?")) {
        RestClient.delete(
          "/admins/delete/" + admin_id,
          {},
          function(data) {
            console.log("Admin with id ",admin_id," is deleted successfully");
            // var updatedUsers = users.filter(function(user) {
            //         return user.id !== userId;
            //     });
                // Update local storage with the updated user data
                // var index = users.findIndex(function(user) {
                //     return user.id === userId;
                // });
                // // Remove the user from the array
                // if (index !== -1) {
                //     users.splice(index, 1);
                // }
                // localStorage.setItem('userData', JSON.stringify(updatedUsers));
                // // Reload DataTable with the updated user data
                // initializeDatatable("#tutorials-table", users);
          },
        function(error) {
            // Handle error response
            console.error("Error deleting admin:", error);
            // Optionally, display the error message to the user
            alert("An error occurred while deleting the admin. Please try again later.");
        }
      );
  }
}


  
	</script>
<script>console.log("caoooooo")</script>
	<script src="../services/products.js"></script>	 
	 <script>productFun();</script>
	 <script src="../services/admins.js"></script>
	 <script>adminFun();</script>
<script src="../utils/rest_client.js"></script>
<script src="../utils/constants.js"></script>
<script src="../utils/utils.js"></script>
<script>
	// if (!(Utils.get_from_localstorage("user"))) {
	// 	window.location = "http://localhost/Web-Project/#userLogin";
	//   } 
</script>
</html>